<?php

namespace Flock\MainBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * FlockRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class FlockRepository extends EntityRepository
{
    /**
     * @param $limit
     * @param $offset
     * @return array
     */
    public function getActiveFlocks($limit, $offset)
    {
        $query = $this->createQueryBuilder('f')
            ->select()
            ->where('f.startsAt > :currentDateTime')
            ->orderBy('f.startsAt','ASC')
            ->setParameter('currentDateTime', new \DateTime('now', new \DateTimeZone('Pacific/Honolulu')))
            ->setFirstResult($offset)
            ->setMaxResults($limit)
            ->getQuery();
        return $query->getResult();
    }

    public function getActiveFlocksCount()
    {
        $query = $this->getEntityManager()->createQuery('SELECT COUNT(f.id) FROM '.$this->getEntityName().' f');

        return $query->getSingleScalarResult();
    }
}
